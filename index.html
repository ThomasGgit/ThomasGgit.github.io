<!DOCTYPE html>
<html>
	<head>
		<title>Driftkort</title>


		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<script src="https://unpkg.com/stackedit-js@1.0.7/docs/lib/stackedit.min.js"></script>
		<script type="text/javascript" src="yaml.js"></script>

		<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		
		<style>
			body {
			  margin: 0;
			  font-family: "Lato", sans-serif;
			}
			
			.responsive {
			  width: 100%;
			  height: auto;
			}
			
			.sidebar {
			  margin: 0;
			  padding: 0;
			  width: 200px;
			  background-color: #f1f1f1;
			  position: fixed;
			  height: 100%;
			  overflow: auto;
			}

			.sidebar a {
			  display: block;
			  color: black;
			  padding: 16px;
			  text-decoration: none;
			}
			 
			.sidebar a.active {
			  background-color: #04AA6D;
			  color: white;
			}

			.sidebar a:hover:not(.active) {
			  background-color: #555;
			  color: white;
			}

			div.main {
			  margin-left: 200px;
			  padding: 1px 16px;
			  height: 1000px;
			}

			@media screen and (max-width: 700px) {
			  .sidebar {
				width: 100%;
				height: auto;
				position: relative;
			  }
			  .sidebar a {float: left;}
			  div.main {margin-left: 0;}
			}

			@media screen and (max-width: 400px) {
			  .sidebar a {
				text-align: center;
				float: none;
			  }
			}
			
			.table-wrapper table {
			  border-collapse: collapse;
			  border: 1px solid grey;
			  table-layout: auto;
			  width: 100%; 
			}
			.table-wrapper th, .table-wrapper td{
			  border: 1px solid grey;
			}
		</style>

		<script>
			/*
				https://thomasggit.github.io/
				
				https://benweet.github.io/stackedit.js/
				
				https://zerodevx.github.io/zero-md/
				
				https://github.com/jeremyfa/yaml.js
				
				
				Krav:
					Inlogg
					URL
					Editering
					Dynaiskt
					
				Att lösa:
					Flera system
					Bookmarks
					Tabeller med larm, inställningar, mätvärden
					Klicka upp utförligare info
					Hämta eller ta emot info kring vad som är aktivt
					Redigera sidor
					Export PDF
					SVG
					
				Framtida:
					Klicka på symbol så highlightas den i texten
					Sidhuvud och sidfot i export
				
			*/
			var undercentral = {};
			var AI_Controller = {};
			var Framledningsreglering = {};
			var Pumpstart = {};
			var Sidintro = {};
			
			const stackedit = new Stackedit();
			
			$(document).ready(function(){
				console.log('Version 0.0.0.25');
				
				
				$.get( "/Example/Fastighet01/Undercentral.md", function( data ) {
					//console.log(data);
					
					undercentral.raw = data;
					var test = data.split("---");
					
					undercentral.yaml = test[1].trim();
					undercentral.text = test[2].trim();
					
					//console.log(undercentral);
					
					//undercentral.yaml = YAML.eval(test[1].trim());
					undercentral.yaml = YAML.parse(test[1].trim());
					
					console.log(undercentral);
					labb1();
				});
				
				$.get( "/Example/Malltexter/AI_Controller.md", function( data ) {
					//console.log(data);
					
					AI_Controller.raw = data;
					AI_Controller.yaml = null;
					AI_Controller.text = data;
					
					//console.log(AI_Controller);
					labb1();
				});
				
				$.get( "/Example/Malltexter/Framledningsreglering.md", function( data ) {
					//console.log(data);
					
					Framledningsreglering.raw = data;
					Framledningsreglering.yaml = null;
					Framledningsreglering.text = data;
					
					//console.log(Framledningsreglering);
					labb1();
				});
				
				$.get( "/Example/Malltexter/Pumpstart.md", function( data ) {
					//console.log(data);
					
					Pumpstart.raw = data;
					Pumpstart.yaml = null;
					Pumpstart.text = data;
					
					//console.log(Pumpstart);
					labb1();
				});
				
				$.get( "/Example/Malltexter/Sidintro.md", function( data ) {
					//console.log(data);
					
					Sidintro.raw = data;
					Sidintro.yaml = null;
					Sidintro.text = data;
					
					//console.log(Sidintro);
					labb1();
				});
				
				
			});
			
			var doneCount = 0;
			function labb1 () {
				if (++doneCount == 5){
				
					var el = $('#content');
					
					//console.log(undercentral.text);
					
					for (var i=0;i<10; i++) {
						undercentral.text = undercentral.text.replace("![[AI_Controller]]", AI_Controller.text);
						undercentral.text = undercentral.text.replace("![[Framledningsreglering]]", Framledningsreglering.text);
						undercentral.text = undercentral.text.replace("![[Pumpstart]]", Pumpstart.text);
						undercentral.text = undercentral.text.replace("![[Sidintro]]", Sidintro.text);
					}
					//console.log(undercentral.text);
					
					var test1Old = 0;
					var test1 = undercentral.text.indexOf("#system-", test1+1);
					var text = [];
					while (test1 > 0) {
						console.log(test1);
						text.push(undercentral.text.substring(test1Old, test1));
						
						
						test1Old = test1;
						test1 = undercentral.text.indexOf("#system-", test1+1);
					}
					text.push(undercentral.text.substring(test1Old));
					console.log(text);
					
					undercentral.text = "";
					for (var i=0;i<text.length; i++) {
						//console.log("hej1");
					
						//console.log(text[i]);
						
						if (undercentral.yaml.cabinet != undefined)
							text[i] = text[i].replace(/#cabinet/gi, undercentral.yaml.cabinet);
						if (undercentral.yaml.positioned != undefined)
							text[i] = text[i].replace(/#positioned/gi, undercentral.yaml.positioned);
						
						var systemName;
						text[i] = text[i].replace(/#system-[A-Ö,0-9]+\s/i, function (x){
							systemName = x.replace("#system-", "");
							return "## System " + systemName;
						});
						console.log(systemName);
						
						if (systemName != undefined) {
							var yaml2;
							for (var j=0;j<undercentral.yaml.systems.length; j++) {
								console.log("Hej4");
								console.log(undercentral.yaml.systems[j].name);
								console.log((undercentral.yaml.systems[j].name == systemName));
								
								if (undercentral.yaml.systems[j].name == systemName) {
									console.log("Hej5");
									yaml2 = undercentral.yaml.systems[j];
								}
							}
							if (yaml2 != undefined) {
								console.log("Hej6");
								if (yaml2.components.forwardtemp != undefined)
									text[i] = text[i].replace(/#forwardtemp/g, yaml2.components.forwardtemp);
								if (yaml2.components.returntemp != undefined)
									text[i] = text[i].replace(/#returntemp/g, yaml2.components.returntemp);
								if (yaml2.components.pump != undefined)
									text[i] = text[i].replace(/#pump/g, yaml2.components.pump);
							}
						}
						
						//console.log("hej2");
						undercentral.text += text[i];
						//console.log("hej3");
					}
					//console.log(undercentral.text);
					
					stackedit.openFile({
						content: { text: undercentral.text }
					}, true);
					
					
					stackedit.on('fileChange', (file) => {
						console.log(file);
						el.html(file.content.html);
					});
				}
			}
			
			
		</script>

	</head>

	<body>

		<div class="sidebar">
			<a href="#">Home</a>
			<a href="#system-fjv">FJV</a>
			<a href="#system-vs01">VS01</a>
		</div>
			
		<div class="main">
			<img src="./Example/Fastighet01/Undercentral.svg" class="responsive">
			<div id="content"></div>
		</div>

	</body>
</html>