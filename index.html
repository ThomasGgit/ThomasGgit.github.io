<!DOCTYPE html>
<html>
	<head>
		<title>Driftkort</title>

		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<script src="https://unpkg.com/stackedit-js@1.0.7/docs/lib/stackedit.min.js"></script>
		<script type="text/javascript" src="yaml.js"></script>

		<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		
		<style>
			html {
				height: 100%;
			}

			body {
				height: 100%;
				margin: 0;
				font-family: Ubuntu;
				background: linear-gradient(#b3ffab, #67fffc);
			}

			#header {
				height: 30px;
				display: flex;
				align-items: center;
				background: linear-gradient(#444444, #333333);
				color: #bbbbbb;
			}

			#headerContent {
				margin-left: 10px;
			}

			#page {
				display: flex;
				height: calc( 100vh - 30px);
			}

			#sideBar {
				width: 100px;
				background: grey;
			}

			#content {
				flex: 1 0 auto;
				/* enable grow, disable shrink */
			}
		</style>

		<script>
			/*
				https://thomasggit.github.io/
				
				https://benweet.github.io/stackedit.js/
				
				https://zerodevx.github.io/zero-md/
				
				https://github.com/jeremyfa/yaml.js
				
			*/
			var undercentral = {};
			var AI_Controller = {};
			var Framledningsreglering = {};
			var Pumpstart = {};
			var Sidintro = {};
			
			const stackedit = new Stackedit();
			
			$(document).ready(function(){
				console.log('Version 0.0.0.13');
				
				
				$.get( "/Example/Fastighet01/Undercentral.md", function( data ) {
					//console.log(data);
					
					undercentral.raw = data;
					var test = data.split("%%");
					
					undercentral.yaml = test[1].trim();
					undercentral.text = test[2].trim();
					
					
					
					console.log(undercentral);
					
					//undercentral.yaml = YAML.eval(test[1].trim());
					undercentral.yaml = YAML.parse(test[1].trim());
					
					console.log(undercentral);
					labb1();
				});
				
				$.get( "/Example/Malltexter/AI_Controller.md", function( data ) {
					//console.log(data);
					
					AI_Controller.raw = data;
					AI_Controller.yaml = null;
					AI_Controller.text = data;
					
					console.log(AI_Controller);
					labb1();
				});
				
				$.get( "/Example/Malltexter/Framledningsreglering.md", function( data ) {
					//console.log(data);
					
					Framledningsreglering.raw = data;
					Framledningsreglering.yaml = null;
					Framledningsreglering.text = data;
					
					console.log(Framledningsreglering);
					labb1();
				});
				
				$.get( "/Example/Malltexter/Pumpstart.md", function( data ) {
					//console.log(data);
					
					Pumpstart.raw = data;
					Pumpstart.yaml = null;
					Pumpstart.text = data;
					
					console.log(Pumpstart);
					labb1();
				});
				
				$.get( "/Example/Malltexter/Sidintro.md", function( data ) {
					//console.log(data);
					
					Sidintro.raw = data;
					Sidintro.yaml = null;
					Sidintro.text = data;
					
					console.log(Sidintro);
					labb1();
				});
				
				
				/*el.load("/Example/Fastighet01/Undercentral.md", function(responseTxt, statusTxt, xhr) {
					
					//console.log(responseTxt);
					stackedit.openFile({
						content: { text: responseTxt }
					}, true);
					
				});*/
				
				/*// Open the iframe
				stackedit.openFile({
					name: 'test.md', // with an optional filename
					//content: { text: 'Hello **Markdown** writer!' }
					content: { text: el.text() }
				}, true);
*/
				// Listen to StackEdit events and apply the changes to the textarea.
				
			});
			
			var doneCount = 0;
			function labb1 () {
				if (++doneCount == 5){
				
					var el = $('#content');
					
					console.log(undercentral.text);
					
					undercentral.text = undercentral.text.replace(/![[AI_Controller]]/g, AI_Controller.text);
					undercentral.text = undercentral.text.replace(/![[Framledningsreglering]]/g, Framledningsreglering.text);
					undercentral.text = undercentral.text.replace(/![[Pumpstart]]/g, Pumpstart.text);
					undercentral.text = undercentral.text.replace(/![[Sidintro]]/g, Sidintro.text);
					
					console.log(undercentral.text);
					
					//undercentral.yaml
					
					if (undercentral.yaml.cabinet != undefined)
						undercentral.text = undercentral.text.replace("{{cabinet}}", undercentral.yaml.cabinet);
					if (undercentral.yaml.positioned != undefined)
						undercentral.text = undercentral.text.replace("{{positioned}}", undercentral.yaml.positioned);
					if (undercentral.yaml.systems[0].components.forwardtemp != undefined)
						undercentral.text = undercentral.text.replace("{{forwardtemp}}", undercentral.yaml.systems[0].components.forwardtemp);
					if (undercentral.yaml.systems[0].components.returntemp != undefined)
						undercentral.text = undercentral.text.replace("{{returntemp}}", undercentral.yaml.systems[0].components.returntemp);
					
					console.log(undercentral.text);
					
					stackedit.openFile({
						content: { text: undercentral.text }
					}, true);
					
					
					stackedit.on('fileChange', (file) => {
						console.log(file);
						el.html(file.content.html);
					});
				}
			}
			
			
			
			
			/*;(function(){
			  YAML = {
				valueOf: function(token) {
				  return eval('(' + token + ')')
				},

				tokenize: function(str) {
				  return str.match(/(---|true|false|null|#(.*)|\[(.*?)\]|\{(.*?)\}|[\w\-]+:|-(.+)|\d+\.\d+|\d+|\n+)/g)
				},

				strip: function(str) {
				  return str.replace(/^\s*|\s*$/, '')
				},

				parse: function(tokens) {
				  var token, list = /^-(.*)/, key = /^([\w\-]+):/, stack = {}
				  while (token = tokens.shift())
					if (token[0] == '#' || token == '---' || token == "\n") 
					  continue
					else if (key.exec(token) && tokens[0] == "\n")
					  stack[RegExp.$1] = this.parse(tokens)
					else if (key.exec(token))
					  stack[RegExp.$1] = this.valueOf(tokens.shift())
					else if (list.exec(token))
					  (stack.constructor == Array ?
						stack : (stack = [])).push(this.strip(RegExp.$1))
				  return stack
				},

				eval: function(str) {
				  return this.parse(this.tokenize(str))
				}
			  }
			})()*/
		</script>

	</head>

	<body>
		<div id="header">
			<div id="headerContent">Desktop</div>
		</div>

		<div id="page">
			<div id="sideBar">
				<div>FJV</div>
				<div>VS01</div>
			</div>
			<div id="content"></div>
		</div>

	</body>
</html>